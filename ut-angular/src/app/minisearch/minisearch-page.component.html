<!-- MiniSearch Showcase Page -->
<div class="ms-page" tabindex="-1">

  <!-- HERO SECTION -->
  <header class="ms-hero">
    <div class="ms-hero__badge">~7 kB gzipped &middot; zero dependencies</div>
    <h1 class="ms-hero__title">MiniSearch</h1>
    <p class="ms-hero__subtitle">
      Lekka biblioteka do wyszukiwania pełnotekstowego w przeglądarce. Prefix, fuzzy, boosting,
      filtry, podpowiedzi &mdash; wszystko po stronie klienta, błyskawicznie.
    </p>
    <div class="ms-hero__stats">
      @if (svc.state().status === 'ready') {
        <span class="ms-stat">
          <strong>{{ svc.documentCount() }}</strong> dok. zaindeksowanych
        </span>
        <span class="ms-stat">
          <strong>{{ svc.indexTimeMs() | number:'1.0-0' }} ms</strong> czas indeksowania
        </span>
        <span class="ms-stat">
          <strong>{{ svc.categories().length }}</strong> kategorie
        </span>
        @if (svc.offlineMode()) {
          <span class="ms-stat ms-stat--offline">
            <strong>OFFLINE</strong>
          </span>
        }
      }
    </div>
    <!-- Przełącznik offline (ID-T 11) -->
    @if (svc.state().status === 'ready' || svc.state().status === 'error') {
      <div class="ms-hero__offline">
        @if (svc.offlineMode()) {
          <button class="ms-btn ms-btn--secondary ms-btn--sm" (click)="switchToOnline()" data-tooltip="Wraca do pobierania danych z internetu. Wyszukiwarka przebuduje swoją bazę na podstawie najnowszych danych z serwera. Kliknij, jeśli wcześniej pracowałeś bez połączenia i chcesz wrócić do aktualnych danych.">
            Przełącz na tryb online
          </button>
        } @else {
          <button class="ms-btn ms-btn--secondary ms-btn--sm" (click)="switchToOffline()" data-tooltip="Przełącza wyszukiwarkę na dane zapisane w samej aplikacji — nie potrzebujesz internetu ani serwera. Idealne do prezentacji, pokazów i sytuacji, gdy sieć jest niedostępna.">
            Tryb offline (bez serwera)
          </button>
        }
      </div>
    }
  </header>

  <!-- LOADING STATE -->
  @if (svc.state().status === 'loading') {
    <section class="ms-status ms-status--loading" aria-live="polite">
      <div class="ms-spinner"></div>
      <p>Ładowanie i indeksowanie dokumentów&hellip;</p>
    </section>
  }

  <!-- ERROR STATE -->
  @if (svc.state().status === 'error') {
    <section class="ms-status ms-status--error" role="alert">
      <span class="ms-status__icon">!</span>
      <p>{{ svc.state().error }}</p>
      <button class="ms-btn ms-btn--primary" (click)="svc.loadAndIndex()">Ponów</button>
      <button class="ms-btn ms-btn--secondary" (click)="switchToOffline()" style="margin-left: 0.5rem" data-tooltip="Serwer nie odpowiada? Nie szkodzi — możesz przełączyć się na dane zapisane w aplikacji i dalej korzystać z wyszukiwarki. Wszystko zadziała bez internetu.">
        Użyj danych offline
      </button>
    </section>
  }

  <!-- MAIN CONTENT (when ready) -->
  @if (svc.state().status === 'ready') {

    <!-- INTERACTIVE PLAYGROUND -->
    <section class="ms-playground" aria-label="Plac zabaw wyszukiwania">
      <h2 class="ms-section-title">Interaktywny plac zabaw</h2>
      <p class="ms-section-desc">Wyszukuj w zbiorze dokumentacji MiniSearch w czasie rzeczywistym.</p>

      <!-- Search Input -->
      <div class="ms-search-bar" role="search">
        <svg class="ms-search-bar__icon" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
          <path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        <input
          #searchInput
          type="search"
          class="ms-search-bar__input"
          placeholder="Szukaj w dokumentacji... (Alt+Shift+M)"
          [ngModel]="queryInput"
          (ngModelChange)="onQueryChange($event)"
          aria-label="Wyszukiwanie w dokumentacji MiniSearch"
        />
        @if (queryInput) {
          <button class="ms-search-bar__clear" (click)="clearSearch()" aria-label="Wyczyść wyszukiwanie" data-tooltip="Kasuje wpisany tekst i chowa wyniki. Pole wyszukiwania zostaje aktywne, więc możesz od razu wpisać coś nowego.">
            <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
          </button>
        }
      </div>

      <!-- Keyboard shortcut hint -->
      <div class="ms-shortcut-hint">
        <kbd>Alt</kbd> + <kbd>Shift</kbd> + <kbd>M</kbd> — przejdź do wyszukiwarki
      </div>

      <!-- Search Controls -->
      <div class="ms-controls">
        <button
          class="ms-toggle"
          [class.ms-toggle--active]="svc.options().prefix"
          (click)="toggleOption('prefix')"
          [attr.aria-pressed]="svc.options().prefix"
          data-tooltip="Wpisz początek słowa, a wyszukiwarka znajdzie wszystkie pasujące hasła. Na przykład wpisanie 'ang' znajdzie 'angular', 'angielski' itp. Działa jak podpowiadanie w Google."
        >Prefix</button>
        <button
          class="ms-toggle"
          [class.ms-toggle--active]="svc.options().fuzzy"
          (click)="toggleOption('fuzzy')"
          [attr.aria-pressed]="svc.options().fuzzy"
          data-tooltip="Toleruje literówki i drobne błędy w pisowni. Jeśli wpiszesz 'anglar' zamiast 'angular', wyszukiwarka i tak znajdzie właściwe wyniki."
        >Fuzzy</button>
        <button
          class="ms-toggle"
          [class.ms-toggle--active]="svc.options().boost"
          (click)="toggleOption('boost')"
          [attr.aria-pressed]="svc.options().boost"
          data-tooltip="Wyniki, w których szukane słowo pojawia się w tytule, zostaną pokazane wyżej na liście. Przydatne, gdy chcesz najpierw zobaczyć najważniejsze trafienia."
        >Wzmocnij tytuł</button>
        <button
          class="ms-toggle"
          [class.ms-toggle--active]="svc.options().combineWith !== 'OR'"
          (click)="toggleCombine()"
          [attr.aria-pressed]="svc.options().combineWith !== 'OR'"
          [attr.data-tooltip]="getCombineTooltip()"
        >{{ getCombineLabel() }}</button>
        <button
          class="ms-toggle"
          [class.ms-toggle--active]="svc.options().ngramEnabled"
          (click)="toggleIndexOption('ngramEnabled')"
          [attr.aria-pressed]="svc.options().ngramEnabled"
          data-tooltip="Przełącza indeks na n-gramy (podciągi znaków). Zamiast pełnych słów wyszukiwarka rozbija tekst na krótkie fragmenty — dzięki temu znajdzie wyniki nawet po wpisaniu środkowej części słowa. Reszta opcji (prefix, fuzzy, boost) zostaje bez zmian, żebyś mógł uczciwie porównać czas na wykresie."
        >N-gram</button>
      </div>

      <!-- Category Filters -->
      <div class="ms-filters" role="group" aria-label="Filtry kategorii">
        <button
          class="ms-filter-chip"
          [class.ms-filter-chip--active]="svc.options().categoryFilter === null"
          [attr.aria-pressed]="svc.options().categoryFilter === null"
          (click)="setCategoryFilter(null)"
          data-tooltip="Wyłącza filtrowanie po kategoriach — widzisz pełną listę wyników ze wszystkich działów dokumentacji. Dobry punkt startowy, zanim zawęzisz wyniki."
        >Wszystko</button>
        @for (cat of svc.categories(); track cat) {
          <button
            class="ms-filter-chip"
            [class.ms-filter-chip--active]="svc.options().categoryFilter === cat"
            [attr.aria-pressed]="svc.options().categoryFilter === cat"
            (click)="setCategoryFilter(cat)"
            data-tooltip="Zawęża wyniki tylko do tej jednej kategorii. Reszta zostaje ukryta."
          >
            {{ getCategoryLabel(cat) }}
            @if (svc.facetCounts()[cat]; as count) {
              <span class="ms-filter-chip__count">{{ count }}</span>
            }
          </button>
        }
      </div>

      <!-- Advanced Options (ID-T 12–19) -->
      <div class="ms-advanced">
        <button class="ms-advanced__toggle" (click)="toggleAdvanced()" [attr.aria-expanded]="showAdvanced()">
          {{ showAdvanced() ? '▾' : '▸' }} Opcje zaawansowane
        </button>
        @if (showAdvanced()) {
          <div class="ms-advanced__panel">

            <!-- Przeszukiwane pola (ID-T 15) -->
            <div class="ms-advanced__group">
              <h4>Przeszukiwane pola</h4>
              <div class="ms-advanced__chips">
                @for (field of availableFields; track field) {
                  <button class="ms-toggle" [class.ms-toggle--active]="isFieldSelected(field)" (click)="toggleField(field)"
                    data-tooltip="Ogranicza wyszukiwanie do tego jednego pola. Na przykład: zaznacz 'title', żeby szukać tylko w tytułach dokumentów, a nie w ich treści.">
                    {{ field }}
                  </button>
                }
              </div>
              <p class="ms-advanced__hint">Brak zaznaczenia = wszystkie pola</p>
            </div>

            <!-- Per-term (ID-T 12, 13) -->
            <div class="ms-advanced__group">
              <h4>Tryby per-term</h4>
              <div class="ms-advanced__chips">
                <button class="ms-toggle" [class.ms-toggle--active]="svc.options().perTermPrefix" (click)="toggleOption('perTermPrefix')"
                  [attr.aria-pressed]="svc.options().perTermPrefix"
                  data-tooltip="Tryb autouzupełniania tylko dla ostatniego wpisanego słowa. Wcześniejsze słowa muszą pasować dokładnie, ale ostatnie jest uzupełniane automatycznie — tak jak w wyszukiwarce Google.">
                  Prefix per-term
                </button>
                <button class="ms-toggle" [class.ms-toggle--active]="svc.options().perTermFuzzy" (click)="toggleOption('perTermFuzzy')"
                  [attr.aria-pressed]="svc.options().perTermFuzzy"
                  data-tooltip="Toleruje literówki, ale tylko w dłuższych słowach (powyżej 3 znaków). Krótkie słowa muszą być wpisane dokładnie, bo przy nich nawet mała zmiana drastycznie zmienia znaczenie.">
                  Fuzzy per-term
                </button>
              </div>
            </div>

            <!-- maxFuzzy (ID-T 14) -->
            <div class="ms-advanced__group">
              <h4>Maks. fuzzy</h4>
              <div class="ms-advanced__slider-row">
                <input type="range" min="1" max="10" step="1" [value]="svc.options().maxFuzzy"
                  (input)="onNumberChange('maxFuzzy', $any($event.target).value)"
                  data-tooltip="Ile liter może się różnić od oryginału, żeby wyszukiwarka wciąż uznała słowo za trafienie. Wyższa wartość = większa tolerancja na błędy, ale też więcej przypadkowych wyników." />
                <span class="ms-advanced__value">{{ svc.options().maxFuzzy }}</span>
              </div>
            </div>

            <!-- boostTerm (ID-T 16) -->
            <div class="ms-advanced__group">
              <h4>Wzmocnienie słowa</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().boostTermEnabled" (click)="toggleOption('boostTermEnabled')"
                [attr.aria-pressed]="svc.options().boostTermEnabled"
                data-tooltip="Pozwala wskazać jedno konkretne słowo z zapytania, które ma być ważniejsze od pozostałych. Wyniki z tym słowem pojawią się wyżej na liście.">
                Włącz
              </button>
              @if (svc.options().boostTermEnabled) {
                <div class="ms-advanced__inline">
                  <input type="text" class="ms-advanced__input" placeholder="Słowo do wzmocnienia..."
                    [value]="svc.options().boostTermValue"
                    (input)="onTextChange('boostTermValue', $any($event.target).value)" />
                  <div class="ms-advanced__slider-row">
                    <label for="adv-boost-term-factor">Siła:</label>
                    <input id="adv-boost-term-factor" type="range" min="1" max="10" step="0.5" [value]="svc.options().boostTermFactor"
                      (input)="onSliderChange('boostTermFactor', $any($event.target).value)" />
                    <span class="ms-advanced__value">{{ svc.options().boostTermFactor }}x</span>
                  </div>
                </div>
              }
            </div>

            <!-- boostDocument (ID-T 17) -->
            <div class="ms-advanced__group">
              <h4>Wzmocnienie dokumentów wg kategorii</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().boostDocumentEnabled" (click)="toggleOption('boostDocumentEnabled')"
                [attr.aria-pressed]="svc.options().boostDocumentEnabled"
                data-tooltip="Sztucznie podnosi pozycję dokumentów z wybranej kategorii. Na przykład: jeśli wybierzesz 'Pojęcia', to wyniki z tej kategorii pojawią się wyżej, nawet jeśli inne wyniki lepiej pasują do zapytania.">
                Włącz
              </button>
              @if (svc.options().boostDocumentEnabled) {
                <div class="ms-advanced__inline">
                  <select class="ms-advanced__select" [value]="svc.options().boostDocumentCategory"
                    (change)="onTextChange('boostDocumentCategory', $any($event.target).value)">
                    <option value="">— wybierz kategorię —</option>
                    @for (cat of svc.categories(); track cat) {
                      <option [value]="cat">{{ getCategoryLabel(cat) }}</option>
                    }
                  </select>
                  <div class="ms-advanced__slider-row">
                    <label for="adv-boost-doc-factor">Siła:</label>
                    <input id="adv-boost-doc-factor" type="range" min="1" max="10" step="0.5" [value]="svc.options().boostDocumentFactor"
                      (input)="onSliderChange('boostDocumentFactor', $any($event.target).value)" />
                    <span class="ms-advanced__value">{{ svc.options().boostDocumentFactor }}x</span>
                  </div>
                </div>
              }
            </div>

            <!-- Wagi (ID-T 18) -->
            <div class="ms-advanced__group">
              <h4>Wagi dopasowań</h4>
              <div class="ms-advanced__slider-row">
                <label for="adv-fuzzy-weight">Fuzzy:</label>
                <input id="adv-fuzzy-weight" type="range" min="0" max="1" step="0.05" [value]="svc.options().fuzzyWeight"
                  (input)="onSliderChange('fuzzyWeight', $any($event.target).value)"
                  data-tooltip="Jak ważne są wyniki znalezione dzięki tolerancji literówek. Wartość bliżej 0 = wyniki z literówkami schodzą niżej. Wartość bliżej 1 = są tak samo ważne jak dokładne trafienia." />
                <span class="ms-advanced__value">{{ svc.options().fuzzyWeight }}</span>
              </div>
              <div class="ms-advanced__slider-row">
                <label for="adv-prefix-weight">Prefix:</label>
                <input id="adv-prefix-weight" type="range" min="0" max="1" step="0.05" [value]="svc.options().prefixWeight"
                  (input)="onSliderChange('prefixWeight', $any($event.target).value)"
                  data-tooltip="Jak ważne są wyniki znalezione dzięki dopasowaniu początku słowa. Wartość bliżej 0 = te wyniki schodzą niżej. Wartość bliżej 1 = są tak samo ważne jak pełne dopasowania." />
                <span class="ms-advanced__value">{{ svc.options().prefixWeight }}</span>
              </div>
            </div>

            <!-- BM25 Tuning (ID-T 19) -->
            <div class="ms-advanced__group">
              <h4>Tuning BM25</h4>
              <p class="ms-advanced__hint">BM25 to formuła rankingowa decydująca, które wyniki są najbardziej trafne.</p>
              <div class="ms-advanced__slider-row">
                <label for="adv-bm25k">k (nasycenie):</label>
                <input id="adv-bm25k" type="range" min="0.5" max="3" step="0.1" [value]="svc.options().bm25k"
                  (input)="onSliderChange('bm25k', $any($event.target).value)"
                  data-tooltip="Kontroluje, czy powtarzanie tego samego słowa w dokumencie wciąż podnosi jego pozycję. Niska wartość = jedno wystąpienie wystarczy. Wysoka = im więcej powtórzeń, tym lepiej." />
                <span class="ms-advanced__value">{{ svc.options().bm25k }}</span>
              </div>
              <div class="ms-advanced__slider-row">
                <label for="adv-bm25b">b (długość):</label>
                <input id="adv-bm25b" type="range" min="0" max="1" step="0.05" [value]="svc.options().bm25b"
                  (input)="onSliderChange('bm25b', $any($event.target).value)"
                  data-tooltip="Czy długie dokumenty powinny być traktowane gorzej niż krótkie? Wartość 0 = długość nie ma znaczenia. Wartość 1 = krótkie dokumenty są mocno faworyzowane." />
                <span class="ms-advanced__value">{{ svc.options().bm25b }}</span>
              </div>
              <div class="ms-advanced__slider-row">
                <label for="adv-bm25d">d (minimum):</label>
                <input id="adv-bm25d" type="range" min="0" max="1" step="0.05" [value]="svc.options().bm25d"
                  (input)="onSliderChange('bm25d', $any($event.target).value)"
                  data-tooltip="Minimalna granica, poniżej której krótkie dokumenty nie są już karane. Chroni bardzo krótkie teksty (np. jednozdaniowe) przed niesprawiedliwym obniżeniem pozycji." />
                <span class="ms-advanced__value">{{ svc.options().bm25d }}</span>
              </div>
            </div>

            <!-- AND_NOT exclude terms (ID-T 20) -->
            @if (svc.options().combineWith === 'AND_NOT') {
              <div class="ms-advanced__group">
                <h4>Wykluczone terminy (AND NOT)</h4>
                <input type="text" class="ms-advanced__input" placeholder="Słowa do wykluczenia..."
                  [value]="svc.options().excludeTerms"
                  (input)="onTextChange('excludeTerms', $any($event.target).value)"
                  data-tooltip="Wpisz słowa, których NIE chcesz widzieć w wynikach. Dokumenty zawierające te słowa zostaną ukryte. Oddzielaj słowa spacjami." />
                <p class="ms-advanced__hint">Wyniki pasujące do tych słów zostaną odrzucone.</p>
              </div>
            }

            <!-- Query tree (ID-T 21) -->
            <div class="ms-advanced__group">
              <h4>Zapytanie zagnieżdżone (query tree)</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().queryTreeEnabled" (click)="toggleOption('queryTreeEnabled')"
                [attr.aria-pressed]="svc.options().queryTreeEnabled"
                data-tooltip="Pozwala stworzyć dwa zestawy słów kluczowych. Dokumenty muszą pasować do WSZYSTKICH słów w co najmniej jednym z zestawów. Na przykład: Grupa A 'angular framework' LUB Grupa B 'react library'.">
                Włącz
              </button>
              @if (svc.options().queryTreeEnabled) {
                <div class="ms-advanced__inline">
                  <div class="ms-advanced__query-tree-row">
                    <label for="adv-qt-q1">Grupa A (AND):</label>
                    <input id="adv-qt-q1" type="text" class="ms-advanced__input" placeholder="np. angular framework"
                      [value]="svc.options().queryTreeQuery1"
                      (input)="onTextChange('queryTreeQuery1', $any($event.target).value)" />
                  </div>
                  <div class="ms-advanced__query-tree-label">OR</div>
                  <div class="ms-advanced__query-tree-row">
                    <label for="adv-qt-q2">Grupa B (AND):</label>
                    <input id="adv-qt-q2" type="text" class="ms-advanced__input" placeholder="np. react library"
                      [value]="svc.options().queryTreeQuery2"
                      (input)="onTextChange('queryTreeQuery2', $any($event.target).value)" />
                  </div>
                  <p class="ms-advanced__hint">Każda grupa wymaga wszystkich słów (AND). Grupy łączone są przez OR.</p>
                </div>
              }
            </div>

            <!-- Wildcard (ID-T 22–23) -->
            <div class="ms-advanced__group">
              <h4>Wildcard (pokaż wszystko)</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().wildcardMode" (click)="toggleOption('wildcardMode')"
                [attr.aria-pressed]="svc.options().wildcardMode"
                data-tooltip="Wyświetla WSZYSTKIE dokumenty w bazie, niezależnie od zapytania. Przydatne, gdy chcesz przejrzeć całą kolekcję lub użyć filtrów kategorii do przeglądania.">
                Pokaż wszystko
              </button>
              <p class="ms-advanced__hint">Włącz, aby zobaczyć wszystkie dokumenty (MiniSearch.wildcard). Łącz z filtrami kategorii i ról.</p>
            </div>

            <!-- Filter callback (ID-T 24) -->
            <div class="ms-advanced__group">
              <h4>Strategia filtrowania</h4>
              <div class="ms-advanced__chips">
                @for (fs of filterStrategies; track fs) {
                  <button class="ms-toggle" [class.ms-toggle--active]="svc.options().filterStrategy === fs"
                    (click)="onTextChange('filterStrategy', fs)"
                    data-tooltip="Wybiera dodatkowy warunek filtrowania wyników: brak dodatkowego filtra, filtr po minimalnej długości tekstu lub filtr po konkretnym tagu.">
                    {{ getFilterStrategyLabel(fs) }}
                  </button>
                }
              </div>
              @if (svc.options().filterStrategy === 'minLength') {
                <div class="ms-advanced__slider-row">
                  <label for="adv-filter-min-len">Min. znaków:</label>
                  <input id="adv-filter-min-len" type="range" min="10" max="200" step="10" [value]="svc.options().filterMinLength"
                    (input)="onNumberChange('filterMinLength', $any($event.target).value)"
                    data-tooltip="Ustawia minimalną długość tekstu dokumentu (w znakach). Dokumenty z krótszym tekstem zostaną ukryte. Przydatne, gdy chcesz odfiltrować niekompletne wpisy." />
                  <span class="ms-advanced__value">{{ svc.options().filterMinLength }}</span>
                </div>
              }
              @if (svc.options().filterStrategy === 'hasTag') {
                <input type="text" class="ms-advanced__input" placeholder="Wpisz tag..."
                  [value]="svc.options().filterTag"
                  (input)="onTextChange('filterTag', $any($event.target).value)"
                  data-tooltip="Wpisz nazwę tagu — zostaną pokazane tylko dokumenty oznaczone tym tagiem. Tagi to etykiety przypisane do dokumentów, np. 'wydajność' lub 'początkujący'." />
              }
            </div>

            <!-- Role-based filtering (ID-T 25) -->
            <div class="ms-advanced__group">
              <h4>Filtr roli</h4>
              <div class="ms-advanced__chips">
                @for (role of availableRoles; track role) {
                  <button class="ms-toggle" [class.ms-toggle--active]="svc.options().roleFilter === role"
                    (click)="onTextChange('roleFilter', role)"
                    data-tooltip="Symuluje uprawnienia różnych użytkowników. 'Gość' nie widzi dokumentacji technicznej API. 'Admin' widzi absolutnie wszystko. 'Wszyscy' to widok domyślny.">
                    {{ getRoleLabel(role) }}
                  </button>
                }
              </div>
              <p class="ms-advanced__hint">Guest nie widzi kategorii 'Dokumentacja API'. Admin widzi wszystko.</p>
            </div>

            <!-- Score explanation (ID-T 26) -->
            <div class="ms-advanced__group">
              <h4>Wyjaśnienie punktacji</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().showScoreExplanation" (click)="toggleOption('showScoreExplanation')"
                [attr.aria-pressed]="svc.options().showScoreExplanation"
                data-tooltip="Przy każdym wyniku pojawi się dodatkowa informacja: które słowa z Twojego zapytania zostały znalezione i w jakich częściach dokumentu (tytuł, treść, tagi).">
                Pokaż szczegóły
              </button>
            </div>

            <!-- autoSuggest options (ID-T 27–29) -->
            <div class="ms-advanced__group">
              <h4>Opcje podpowiedzi (autoSuggest)</h4>
              <div class="ms-advanced__chips">
                <button class="ms-toggle" [class.ms-toggle--active]="svc.options().suggestPrefix" (click)="toggleOption('suggestPrefix')"
                  [attr.aria-pressed]="svc.options().suggestPrefix"
                  data-tooltip="Podpowiedzi będą szukać słów zaczynających się od wpisanego fragmentu. Wpisujesz 'ang'? Podpowiedzi zaproponują 'angular'.">
                  Prefix
                </button>
                <button class="ms-toggle" [class.ms-toggle--active]="svc.options().suggestFuzzy" (click)="toggleOption('suggestFuzzy')"
                  [attr.aria-pressed]="svc.options().suggestFuzzy"
                  data-tooltip="Podpowiedzi będą tolerować literówki — niezależnie od głównego ustawienia wyszukiwania. Wpisujesz 'anglar'? Podpowiedzi i tak zaproponują 'angular'.">
                  Fuzzy
                </button>
                <button class="ms-toggle" [class.ms-toggle--active]="svc.options().suggestFilterEnabled" (click)="toggleOption('suggestFilterEnabled')"
                  [attr.aria-pressed]="svc.options().suggestFilterEnabled"
                  data-tooltip="Podpowiedzi będą brały pod uwagę wybrany filtr kategorii. Jeśli filtrujesz po 'Pojęcia', podpowiedzi pokażą tylko hasła z tej kategorii.">
                  Filtr kategorii
                </button>
                <button class="ms-toggle" [class.ms-toggle--active]="svc.options().suggestCombineWith === 'AND'"
                  (click)="svc.updateOption('suggestCombineWith', svc.options().suggestCombineWith === 'OR' ? 'AND' : 'OR')"
                  [attr.aria-pressed]="svc.options().suggestCombineWith === 'AND'"
                  data-tooltip="Czy podpowiedzi mają wymagać WSZYSTKICH wpisanych słów (tryb AND), czy wystarczy jedno z nich (tryb OR). AND = węższe, celniejsze podpowiedzi. OR = szersze, więcej propozycji.">
                  {{ svc.options().suggestCombineWith }}
                </button>
              </div>
              <p class="ms-advanced__hint">Niezależne sterowanie podpowiedziami: prefix, fuzzy, filtr i łącznik.</p>
            </div>

            <!-- ════════ KONFIGURACJA INDEKSU (ID-T 30–39) ════════ -->
            <div class="ms-advanced__separator">
              <h3 class="ms-advanced__section-title">Konfiguracja indeksu</h3>
              <p class="ms-advanced__hint">Zmiana tych opcji przebudowuje indeks od nowa. Czas przebudowy: {{ svc.indexTimeMs() | number:'1.0-0' }} ms</p>
            </div>

            <!-- extractField nested (ID-T 30) -->
            <div class="ms-advanced__group">
              <h4>Zagnieżdżone pola (extractField nested)</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().extractNestedEnabled" (click)="toggleIndexOption('extractNestedEnabled')"
                [attr.aria-pressed]="svc.options().extractNestedEnabled"
                data-tooltip="Dodaje do wyszukiwarki pole 'autor dokumentu', które normalnie jest ukryte w strukturze danych. Po włączeniu możesz szukać dokumentów po nazwisku autora, np. 'Kowalski'.">
                Włącz
              </button>
              <p class="ms-advanced__hint">Indeksuje pole <code>metadata.author</code> — szukaj np. 'Kowalski' lub 'Nowak' (tryb offline).</p>
            </div>

            <!-- extractField derived (ID-T 31) -->
            <div class="ms-advanced__group">
              <h4>Pola pochodne (extractField derived)</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().extractDerivedEnabled" (click)="toggleIndexOption('extractDerivedEnabled')"
                [attr.aria-pressed]="svc.options().extractDerivedEnabled"
                data-tooltip="Tworzy nowe pole łączące tytuł i kategorię dokumentu w jedno. Dzięki temu jedno wyszukanie może trafić jednocześnie w tytuł i w nazwę kategorii.">
                Włącz
              </button>
              <p class="ms-advanced__hint">Pole <code>summary</code> = tytuł + kategoria — wyszukiwanie łączy oba konteksty.</p>
            </div>

            <!-- stringifyField (ID-T 32) -->
            <div class="ms-advanced__group">
              <h4>Serializacja pól (stringifyField)</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().stringifyFieldEnabled" (click)="toggleIndexOption('stringifyFieldEnabled')"
                [attr.aria-pressed]="svc.options().stringifyFieldEnabled"
                data-tooltip="Zmienia format zapisu tagów w wyszukiwarce. Zamiast zwykłego 'search' zapisuje 'concepts:search' — dzięki temu możesz szukać tagów w konkretnej kategorii.">
                Włącz
              </button>
              <p class="ms-advanced__hint">Tagi stają się <code>kategoria:tag</code> — szukaj np. 'concepts:search' (tryb offline).</p>
            </div>

            <!-- custom tokenize (ID-T 33) -->
            <div class="ms-advanced__group">
              <h4>Tokenizator niestandardowy</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().customTokenizeEnabled" (click)="toggleIndexOption('customTokenizeEnabled')"
                [attr.aria-pressed]="svc.options().customTokenizeEnabled"
                data-tooltip="Rozbija złożone nazwy na osobne słowa. Na przykład 'MiniSearch' staje się 'mini' + 'search', a 'auto-suggest' staje się 'auto' + 'suggest'. Ułatwia znajdowanie fragmentów nazw.">
                CamelCase tokenizer
              </button>
              <p class="ms-advanced__hint">Rozbija 'MiniSearch' na 'mini' + 'search', 'auto-suggest' na 'auto' + 'suggest'.</p>
            </div>

            <!-- tokenize split index/search (ID-T 34) -->
            <div class="ms-advanced__group">
              <h4>Osobne tokenizatory (index / search)</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().splitTokenizeEnabled" (click)="toggleIndexOption('splitTokenizeEnabled')"
                [attr.aria-pressed]="svc.options().splitTokenizeEnabled"
                data-tooltip="Używa różnych reguł dzielenia tekstu przy zapisie i przy wyszukiwaniu. Zapis: rozbija złożone nazwy typu MiniSearch. Wyszukiwanie: dzieli normalnie po spacjach.">
                Włącz split tokenize
              </button>
              <p class="ms-advanced__hint">Indeks: CamelCase tokenizer. Wyszukiwanie: standardowy (po spacji). Dwa niezależne pipeline.</p>
            </div>

            <!-- processTerm normalization (ID-T 35) -->
            <div class="ms-advanced__group">
              <h4>Normalizacja terminów</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().processTermNormEnabled" (click)="toggleIndexOption('processTermNormEnabled')"
                [attr.aria-pressed]="svc.options().processTermNormEnabled"
                data-tooltip="Ignoruje polskie ogonki i znaki specjalne. Po włączeniu nie musisz wpisywać ogonków — 'szukanie' i 'wyszukiwanie' będą traktowane tak samo. Wpisujesz bez ogonków? I tak znajdziesz właściwe wyniki.">
                Normalizacja (diakrytyki)
              </button>
              <p class="ms-advanced__hint">Zamienia ą→a, ć→c, ę→e itd. 'wyszukiwanie' trafi na zapytanie 'wyszukiwanie' i 'wyszukiwanie'.</p>
            </div>

            <!-- processTerm split index/search (ID-T 36) -->
            <div class="ms-advanced__group">
              <h4>Osobne przetwarzanie (index / search)</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().splitProcessTermEnabled" (click)="toggleIndexOption('splitProcessTermEnabled')"
                [attr.aria-pressed]="svc.options().splitProcessTermEnabled"
                data-tooltip="Przy zapisie do bazy: normalizuje tekst i zamienia na małe litery. Przy wyszukiwaniu: tylko zamienia na małe litery, bez usuwania ogonków. Dwa niezależne zestawy reguł.">
                Włącz split processTerm
              </button>
              <p class="ms-advanced__hint">Indeks: normalizacja + lowercase. Search: tylko lowercase. Wymaga włączonej normalizacji.</p>
            </div>

            <!-- processTerm synonyms (ID-T 37) -->
            <div class="ms-advanced__group">
              <h4>Synonimy</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().synonymsEnabled" (click)="toggleIndexOption('synonymsEnabled')"
                [attr.aria-pressed]="svc.options().synonymsEnabled"
                data-tooltip="Automatycznie rozszerza słowa o ich odpowiedniki. Wpisujesz 'js'? Wyszukiwarka szuka też 'javascript'. 'Frontend'? Szuka też 'gui' i 'ui'. Więcej trafień bez dodatkowego wysiłku.">
                Włącz synonimy
              </button>
              <p class="ms-advanced__hint">Przy indeksowaniu: js→javascript, ts→typescript, frontend→gui/ui, szukaj→wyszukaj/znajdz.</p>
            </div>

            <!-- processTerm discard (ID-T 38) -->
            <div class="ms-advanced__group">
              <h4>Stop-words (odrzucanie)</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().discardTermsEnabled" (click)="toggleIndexOption('discardTermsEnabled')"
                [attr.aria-pressed]="svc.options().discardTermsEnabled"
                data-tooltip="Ignoruje bardzo popularne, krótkie słowa, które nie niosą treści (np. 'i', 'w', 'na', 'the', 'a'). Bez nich wyniki wyszukiwania są celniejsze i mniej zaszumione.">
                Włącz stop-words
              </button>
              <p class="ms-advanced__hint">Odrzuca: i, w, na, z, do, to, the, a, an, is… — poprawia trafność rankingu.</p>
            </div>

            <!-- custom idField (ID-T 39) -->
            <div class="ms-advanced__group">
              <h4>Niestandardowy identyfikator (idField)</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().customIdFieldEnabled" (click)="toggleIndexOption('customIdFieldEnabled')"
                [attr.aria-pressed]="svc.options().customIdFieldEnabled"
                data-tooltip="Zmienia wewnętrzną nazwę identyfikatora dokumentu z 'id' na 'docId'. To demonstracja techniczna — pokazuje, że wyszukiwarka nie wymusza konkretnej nazwy pola identyfikatora.">
                Użyj docId
              </button>
              <p class="ms-advanced__hint">Identyfikator: <code>docId</code> = <code>doc-&#123;id&#125;</code> zamiast standardowego <code>id</code>.</p>
            </div>

            <!-- N-gram tokenizer (ID-T 54) -->
            <div class="ms-advanced__group">
              <h4>N-gramy</h4>
              <button class="ms-toggle" [class.ms-toggle--active]="svc.options().ngramEnabled" (click)="toggleIndexOption('ngramEnabled')"
                [attr.aria-pressed]="svc.options().ngramEnabled"
                data-tooltip="Rozbija każde słowo na krótkie fragmenty o ustalonej długości. Na przykład 'angular' (przy długości 3) daje: 'ang', 'ngu', 'gul', 'ula', 'lar'. Dzięki temu wyszukiwarka znajdzie wyniki nawet po wpisaniu środkowej części słowa — ale wyniki mogą być mniej precyzyjne.">
                Włącz n-gramy
              </button>
              @if (svc.options().ngramEnabled) {
                <div class="ms-advanced__slider-row">
                  <label for="adv-ngram-size">Rozmiar n:</label>
                  <input id="adv-ngram-size" type="range" min="2" max="5" step="1" [value]="svc.options().ngramSize"
                    (input)="onIndexNumberChange('ngramSize', $any($event.target).value)"
                    data-tooltip="Długość fragmentów, na które dzielone są słowa. Mniejsza liczba = więcej wyników (ale mniej precyzyjnych). Większa liczba = mniej wyników (ale bardziej trafnych)." />
                  <span class="ms-advanced__value">{{ svc.options().ngramSize }}</span>
                </div>
              }
              <p class="ms-advanced__hint">Rozbija 'angular' (n=3) na: 'ang', 'ngu', 'gul', 'ula', 'lar'. Nadpisuje inne tokenizery.</p>
            </div>

          </div>
        }
      </div>

      <!-- Suggestions -->
      @if (svc.suggestions().length > 0 && queryInput) {
        <div class="ms-suggestions" role="group" aria-label="Podpowiedzi wyszukiwania">
          <span class="ms-suggestions__label">Podpowiedzi:</span>
          @for (s of svc.suggestions(); track s.suggestion) {
            <button
              class="ms-suggestion-chip"
              (click)="onSuggestionClick(s.suggestion)"
              data-tooltip="Kliknij, żeby automatycznie wpisać to hasło w pole wyszukiwania i od razu zobaczyć wyniki."
            >{{ s.suggestion }}</button>
          }
        </div>
      }

      <!-- Search Meta -->
      @if (queryInput) {
        <div class="ms-meta" aria-live="polite">
          <span>{{ svc.results().length }} wyników</span>
          <span class="ms-meta__dot">&middot;</span>
          <span>{{ svc.searchTimeMs() | number:'1.2-2' }} ms</span>
          <button class="ms-meta__rerun" (click)="rerunSearch()"
            data-tooltip="Ponawia wyszukiwanie z tą samą frazą — przydatne po zmianie opcji (np. przełączeniu indeksu), żeby zobaczyć różnicę czasu na wykresie.">
            Ponów
          </button>
        </div>
      }

      <!-- Sparkline Performance Chart -->
      @if (sparklineData(); as spark) {
        <div class="ms-sparkline">
          <div class="ms-sparkline__header">
            <span class="ms-sparkline__title">Wydajność wyszukiwania</span>
            <span class="ms-sparkline__stats">
              min {{ spark.stats.min | number:'1.1-1' }} ms
              &middot; avg {{ spark.stats.avg | number:'1.1-1' }} ms
              &middot; max {{ spark.stats.max | number:'1.1-1' }} ms
            </span>
          </div>
          <div class="ms-sparkline__chart-wrap"
               (mousemove)="onSparklineMove($event)"
               (mouseleave)="onSparklineLeave()">
            <svg class="ms-sparkline__chart" viewBox="0 0 280 48" preserveAspectRatio="none" aria-hidden="true">
              <defs>
                <linearGradient id="sparkGrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="rgba(99, 102, 241, 0.25)" />
                  <stop offset="100%" stop-color="rgba(99, 102, 241, 0)" />
                </linearGradient>
              </defs>
              <path [attr.d]="spark.areaPath" fill="url(#sparkGrad)" />
              <path [attr.d]="spark.linePath" fill="none" stroke="#6366f1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              @if (hoveredSparklinePoint(); as hov) {
                <line [attr.x1]="hov.x" [attr.x2]="hov.x" y1="0" y2="48"
                      stroke="rgba(244,114,182,0.5)" stroke-width="0.5" stroke-dasharray="2 2" />
                <circle [attr.cx]="hov.x" [attr.cy]="hov.y" r="3.5" fill="#f472b6" />
              }
              <circle [attr.cx]="spark.lastPoint.x" [attr.cy]="spark.lastPoint.y" r="3" fill="#818cf8" class="ms-sparkline__dot" />
            </svg>
            @if (hoveredSparklinePoint(); as hov) {
              <div class="ms-sparkline__tooltip" [style.left.%]="hov.x / 2.8">
                {{ hov.timeMs | number:'1.2-2' }} ms &middot; {{ hov.resultCount }} wyn.
              </div>
            }
          </div>
          <div class="ms-sparkline__footer">
            <span>{{ searchHistory().length }} zapytań w historii</span>
            <span class="ms-sparkline__current">
              ostatni: {{ spark.points[spark.points.length - 1].timeMs | number:'1.2-2' }} ms
              &middot; {{ spark.points[spark.points.length - 1].resultCount }} wyn.
            </span>
          </div>
        </div>
      }

      <!-- Results -->
      @if (queryInput && svc.results().length > 0) {
        <ul class="ms-results" role="list">
          @for (r of svc.results(); track trackByResultId($index, r)) {
            <li class="ms-result">
              <div class="ms-result__header">
                <span class="ms-result__category ms-result__category--{{ r.category }}">
                  {{ getCategoryLabel(r.category) }}
                </span>
                <span class="ms-result__score" [attr.data-tooltip]="'Wynik trafności: ' + formatScore(r.score) + '. Im wyższa liczba, tym lepiej dokument pasuje do Twojego zapytania.'">
                  {{ formatScore(r.score) }}
                </span>
              </div>
              <h3 class="ms-result__title" [innerHTML]="r.highlightedTitle"></h3>
              <p class="ms-result__text" [innerHTML]="r.highlightedText"></p>
              <div class="ms-result__actions">
                <a
                  class="ms-result__doc-link"
                  [href]="r.url"
                  target="_blank"
                  rel="noopener noreferrer"
                  data-tooltip="Otwiera oryginalny dokument źródłowy w nowej karcie przeglądarki."
                >
                  Otwórz dokument
                </a>
              </div>
              @if (svc.options().showScoreExplanation) {
                <div class="ms-result__explanation">
                  <span class="ms-result__explanation-label">Dopasowanie:</span>
                  {{ getMatchExplanation(r) }}
                </div>
              }
              @if (r.tags && r.tags.length > 0) {
                <div class="ms-result__tags">
                  @for (tag of r.tags; track tag) {
                    <span class="ms-tag">{{ tag }}</span>
                  }
                </div>
              }
            </li>
          }
        </ul>
      }

      <!-- Empty state -->
      @if (queryInput && svc.results().length === 0) {
        <div class="ms-empty" aria-live="polite">
          <p class="ms-empty__title">Brak wyników</p>
          <p class="ms-empty__hint">
            Spróbuj innego zapytania, włącz wyszukiwanie rozmyte (fuzzy) dla tolerancji literówek
            lub usuń filtry kategorii.
          </p>
        </div>
      }
    </section>

    <!-- LIVE INDEXING -->
    <section class="ms-live-indexing" aria-label="Indeksowanie na żywo">
      <h2 class="ms-section-title">Indeksowanie na żywo</h2>
      <p class="ms-section-desc">Dodawaj, aktualizuj i usuwaj dokumenty, gdy silnik wyszukiwania działa. Bez restartu.</p>

      <!-- Add Document Form -->
      <div class="ms-live-form">
        <h3 class="ms-live-form__title">Dodaj dokument</h3>
        <div class="ms-live-form__fields">
          <div class="ms-live-form__field">
            <label for="live-title">Tytuł</label>
            <input id="live-title" type="text" [ngModel]="liveDoc.title" (ngModelChange)="liveDoc.title = $event" placeholder="np. Przewodnik po indeksowaniu asynchronicznym" />
          </div>
          <div class="ms-live-form__field">
            <label for="live-text">Treść</label>
            <textarea id="live-text" [ngModel]="liveDoc.text" (ngModelChange)="liveDoc.text = $event" placeholder="Treść dokumentu..." rows="2"></textarea>
          </div>
          <div class="ms-live-form__row">
            <div class="ms-live-form__field ms-live-form__field--half">
              <label for="live-tags">Tagi (oddzielone przecinkami)</label>
              <input id="live-tags" type="text" [ngModel]="liveDocTags" (ngModelChange)="liveDocTags = $event" placeholder="np. wydajność, początkujący" />
            </div>
            <div class="ms-live-form__field ms-live-form__field--half">
              <label for="live-category">Kategoria</label>
              <select id="live-category" [ngModel]="liveDoc.category" (ngModelChange)="liveDoc.category = $event">
                <option value="concepts">Pojęcia</option>
                <option value="api">Dokumentacja API</option>
                <option value="examples">Przykłady</option>
                <option value="use-cases">Zastosowania</option>
              </select>
            </div>
          </div>
        </div>
        <div class="ms-live-form__actions">
          <button class="ms-btn ms-btn--primary" (click)="addLiveDocument()" [disabled]="!liveDoc.title.trim()" data-tooltip="Dodaje nowy dokument do bazy wyszukiwarki. Od razu po dodaniu możesz go znaleźć wyszukując — nie trzeba nic restartować ani przebudowywać.">
            Dodaj dokument
          </button>
          <button class="ms-btn ms-btn--secondary" (click)="replaceLiveDocument()" [disabled]="!liveDoc.title.trim()" data-tooltip="Podmienia istniejący dokument (o tym samym numerze) na nową wersję. Stara treść znika, nowa od razu jest wyszukiwalna.">
            Zamień (po ID)
          </button>
        </div>
        @if (liveMessage()) {
          <div class="ms-live-form__message" [class.ms-live-form__message--success]="liveMessageType() === 'success'" role="status">
            {{ liveMessage() }}
          </div>
        }
      </div>

      <!-- ID-T 40/41: Operacje wsadowe -->
      <div class="ms-batch-ops">
        <h3 class="ms-live-form__title">Operacje wsadowe</h3>
        <div class="ms-batch-ops__actions">
          <button class="ms-btn ms-btn--secondary" (click)="addBatchDocuments()"
            data-tooltip="Dodaje 5 przykładowych dokumentów za jednym razem. Wszystkie trafiają do wyszukiwarki natychmiast. Pokazuje, że można dodawać wiele dokumentów na raz.">
            Dodaj paczkę (addAll)
          </button>
          <button class="ms-btn ms-btn--secondary" (click)="addBatchDocumentsAsync()" [disabled]="svc.asyncProgress() !== null"
            data-tooltip="Generuje 100 dokumentów testowych i dodaje je w tle, paczkami po 20. Interfejs nie zamraża się — widać pasek postępu. Pokazuje, jak obsługiwać duże ilości danych.">
            Dodaj 100 async (addAllAsync)
          </button>
          <button class="ms-btn ms-btn--secondary" (click)="addBatchDocuments1000Async()" [disabled]="svc.asyncProgress() !== null"
            data-tooltip="Generuje 1000 dokumentów testowych i dodaje je asynchronicznie, paczkami po 50. Prawdziwy test wydajności — obserwuj pasek postępu i czas indeksowania.">
            Dodaj 1000 async
          </button>
        </div>
        @if (svc.asyncProgress() !== null) {
          <div class="ms-progress-bar" role="progressbar" [attr.aria-valuenow]="svc.asyncProgress()" aria-valuemin="0" aria-valuemax="100">
            <div class="ms-progress-bar__fill" [style.width.%]="svc.asyncProgress()"></div>
            <span class="ms-progress-bar__label">{{ svc.asyncProgress() }}%</span>
          </div>
        }
      </div>

      <!-- Import własnego pliku JSON -->
      <div class="ms-file-import">
        <h3 class="ms-live-form__title">Doindeksuj własny plik</h3>
        <p class="ms-advanced__hint" style="margin-bottom: 0.75rem;">
          Wczytaj plik JSON z tablicą dokumentów. Wymagane pola: <code>title</code> (string), <code>text</code> (string).
          Opcjonalne: <code>tags</code> (string[]), <code>category</code> (string).
        </p>
        <input
          #fileInput
          type="file"
          accept=".json,application/json"
          (change)="onFileSelected($event)"
          style="display: none;"
        />
        <div class="ms-file-import__actions">
          <button class="ms-btn ms-btn--primary ms-btn--sm" (click)="triggerFileImport()" [disabled]="svc.asyncProgress() !== null"
            data-tooltip="Otwiera okno wyboru pliku. Plik musi być w formacie JSON i zawierać tablicę obiektów z polami title i text. Po wczytaniu dokumenty zostaną automatycznie zaindeksowane.">
            Wybierz plik JSON
          </button>
          <span class="ms-file-import__hint">Akceptowane: .json</span>
        </div>
        @if (customFileError()) {
          <div class="ms-file-import__error" role="alert">
            <strong>Błąd walidacji:</strong> {{ customFileError() }}
          </div>
        }
      </div>

      <!-- ID-T 42/43: Usuwanie dokumentów -->
      <div class="ms-remove-ops">
        <h3 class="ms-live-form__title">Usuwanie dokumentów</h3>
        <div class="ms-remove-ops__row">
          <div class="ms-remove-ops__field">
            <label for="remove-id">remove(id)</label>
            <div class="ms-remove-ops__input-group">
              <input id="remove-id" type="number" placeholder="ID dokumentu..." [(ngModel)]="removeDocId"
                data-tooltip="Wpisz numer dokumentu, który chcesz trwale usunąć z wyszukiwarki." />
              <button class="ms-btn ms-btn--secondary ms-btn--sm" (click)="removeLiveDocument()" [disabled]="!removeDocId"
                data-tooltip="Trwale i natychmiast usuwa dokument z wyszukiwarki. Efekt widoczny od razu — dokument znika z wyników.">
                Usuń
              </button>
            </div>
            <p class="ms-advanced__hint">Natychmiastowe usunięcie — wpis znika z indeksu od razu.</p>
          </div>
          <div class="ms-remove-ops__field">
            <label for="discard-id">discard(id)</label>
            <div class="ms-remove-ops__input-group">
              <input id="discard-id" type="number" placeholder="ID dokumentu..." [(ngModel)]="discardDocId"
                data-tooltip="Wpisz numer dokumentu, który chcesz oznaczyć do usunięcia. Dokument zniknie z wyników, ale pamięć zostanie zwolniona dopiero po kliknięciu 'Porządkuj'." />
              <button class="ms-btn ms-btn--secondary ms-btn--sm" (click)="discardLiveDocument()" [disabled]="!discardDocId"
                data-tooltip="Szybkie usunięcie — dokument od razu znika z wyników wyszukiwania, ale fizycznie zajmuje miejsce do momentu kliknięcia 'Porządkuj'. Szybsze niż pełne usunięcie powyżej.">
                Odrzuć
              </button>
            </div>
            <p class="ms-advanced__hint">Leniwe usuwanie — szybsze, ale wymaga vacuum do zwolnienia pamięci. Obserwuj metryki 'brudnych wpisów'.</p>
          </div>
        </div>
        <!-- ID-T 44: discardAll -->
        <div class="ms-remove-ops__discard-all">
          @if (!showDiscardAllConfirm()) {
            <button class="ms-btn ms-btn--secondary" (click)="confirmDiscardAll()"
              data-tooltip="Oznacza WSZYSTKIE dokumenty w bazie do usunięcia. Uwaga: wymaga potwierdzenia. Po kliknięciu 'Porządkuj' pamięć zostanie zwolniona.">
              Odrzuć wszystkie (discardAll)
            </button>
          } @else {
            <div class="ms-confirm-inline">
              <span class="ms-confirm-inline__text">Na pewno odrzucić wszystkie dokumenty?</span>
              <button class="ms-btn ms-btn--primary ms-btn--sm" (click)="executeDiscardAll()">Tak, odrzuć</button>
              <button class="ms-btn ms-btn--secondary ms-btn--sm" (click)="cancelDiscardAll()">Anuluj</button>
            </div>
          }
        </div>
      </div>

      <!-- Index Metrics -->
      <div class="ms-live-metrics">
        <div class="ms-live-metric" data-tooltip="Ile dokumentów jest aktualnie w bazie wyszukiwarki. Rośnie po dodaniu, maleje po usunięciu.">
          <span class="ms-live-metric__value">{{ svc.documentCount() }}</span>
          <span class="ms-live-metric__label">Dokumenty</span>
        </div>
        <div class="ms-live-metric" data-tooltip="Ile różnych, unikalnych słów zna wyszukiwarka. Im więcej dokumentów, tym więcej znanych słów.">
          <span class="ms-live-metric__value">{{ svc.getTermCount() }}</span>
          <span class="ms-live-metric__label">Unikalne terminy</span>
        </div>
        <div class="ms-live-metric" data-tooltip="Ile 'odrzuconych' dokumentów wciąż zajmuje miejsce w pamięci. Kliknij 'Porządkuj', żeby je wyczyścić.">
          <span class="ms-live-metric__value">{{ svc.getDirtCount() }}</span>
          <span class="ms-live-metric__label">Brudne wpisy</span>
        </div>
        <div class="ms-live-metric" data-tooltip="Procent 'śmieci' w bazie. 0% = baza jest czysta. Im wyższy procent, tym więcej pamięci marnuje się na usunięte dane. Kliknij 'Porządkuj', żeby oczyścić.">
          <span class="ms-live-metric__value">{{ formatDirtFactor(svc.getDirtFactor()) }}</span>
          <span class="ms-live-metric__label">Współczynnik brudu</span>
        </div>
        <button class="ms-btn ms-btn--secondary ms-live-metrics__vacuum" (click)="vacuumIndex()" data-tooltip="Sprzątanie — zwalnia pamięć zajmowaną przez usunięte dokumenty i utrzymuje wyszukiwarkę w dobrej formie. Kliknij po usunięciu wielu dokumentów.">
          Porządkuj
        </button>
      </div>

      <!-- ID-T 45: Snapshot indeksu (toJSON / loadJSON / loadJSONAsync) -->
      <div class="ms-snapshot-panel">
        <h3 class="ms-live-form__title">Snapshot indeksu (serializacja)</h3>
        <p class="ms-advanced__hint" style="margin-bottom: 0.75rem;">
          Zapisz cały indeks do JSON i odtwórz go bez ponownego indeksowania. Idealne do cache'owania i szybkiego startu.
        </p>
        <div class="ms-snapshot-panel__actions">
          <button class="ms-btn ms-btn--primary ms-btn--sm" (click)="saveSnapshot()"
            data-tooltip="Zapisuje kopię całej bazy wyszukiwarki jako tekst. Tę kopię można potem wczytać z powrotem bez ponownego indeksowania — jak zapis stanu gry.">
            Zapisz (toJSON)
          </button>
          <button class="ms-btn ms-btn--secondary ms-btn--sm" (click)="loadSnapshot()" [disabled]="!svc.snapshotJson()"
            data-tooltip="Wczytuje zapisaną kopię bazy i odtwarza wyszukiwarkę bez ponownego dodawania dokumentów. Szybki powrót do wcześniejszego stanu.">
            Wczytaj (loadJSON)
          </button>
          <button class="ms-btn ms-btn--secondary ms-btn--sm" (click)="loadSnapshotAsync()" [disabled]="!svc.snapshotJson()"
            data-tooltip="Jak 'Wczytaj', ale działa w tle i nie zamraża interfejsu. Lepsze przy dużych bazach danych.">
            Wczytaj async (loadJSONAsync)
          </button>
        </div>
        @if (snapshotSize()) {
          <div class="ms-snapshot-panel__info">
            <span>Rozmiar snapshotu: <strong>{{ snapshotSize() }}</strong></span>
            @if (snapshotLoadTime() > 0) {
              <span> &middot; Czas wczytania: <strong>{{ snapshotLoadTime() | number:'1.1-1' }} ms</strong></span>
            }
          </div>
        }
      </div>
    </section>

    <!-- N-GRAM COMPARISON (ID-T 54) -->
    <section class="ms-ngram-compare" aria-label="Porównanie n-gram vs standard">
      <h2 class="ms-section-title">N-gram vs Standard</h2>
      <p class="ms-section-desc">
        Wpisz to samo hasło i porównaj wyniki z indeksu standardowego (pełne słowa) oraz n-gramowego (podciągi znaków).
      </p>

      <div class="ms-ngram-compare__search">
        <input
          type="text"
          class="ms-ngram-compare__input"
          placeholder="Wpisz hasło do porównania... np. 'angul'"
          [(ngModel)]="ngramCompareQuery"
          (keyup.enter)="runNgramCompare()"
          data-tooltip="Wpisz hasło i naciśnij Enter, żeby zobaczyć różnicę między zwykłym wyszukiwaniem a wyszukiwaniem po fragmentach słów. Porównanie pokaże, który tryb lepiej radzi sobie z Twoim zapytaniem."
        />
        <button class="ms-btn ms-btn--primary ms-btn--sm" (click)="runNgramCompare()" [disabled]="!ngramCompareQuery.trim()"
          data-tooltip="Uruchamia porównanie: to samo hasło jest wyszukiwane dwoma różnymi metodami — standardową i po fragmentach słów — żeby pokazać różnice w wynikach.">
          Porównaj
        </button>
      </div>

      @if (svc.ngramCompareResults(); as cmp) {
        <div class="ms-ngram-compare__grid">
          <div class="ms-ngram-compare__col">
            <h3 class="ms-ngram-compare__col-title">Standard <span class="ms-ngram-compare__count">({{ cmp.standard.length }})</span></h3>
            @if (cmp.standard.length === 0) {
              <p class="ms-ngram-compare__empty">Brak wyników</p>
            }
            @for (r of cmp.standard; track r.id) {
              <div class="ms-ngram-compare__item">
                <span class="ms-ngram-compare__item-title">{{ r.title }}</span>
                <span class="ms-ngram-compare__item-score">{{ formatScore(r.score) }}</span>
              </div>
            }
          </div>
          <div class="ms-ngram-compare__col ms-ngram-compare__col--ngram">
            <h3 class="ms-ngram-compare__col-title">N-gram (n={{ svc.options().ngramSize }}) <span class="ms-ngram-compare__count">({{ cmp.ngram.length }})</span></h3>
            @if (cmp.ngram.length === 0) {
              <p class="ms-ngram-compare__empty">Brak wyników</p>
            }
            @for (r of cmp.ngram; track r.id) {
              <div class="ms-ngram-compare__item">
                <span class="ms-ngram-compare__item-title">{{ r.title }}</span>
                <span class="ms-ngram-compare__item-score">{{ formatScore(r.score) }}</span>
              </div>
            }
          </div>
        </div>
        <p class="ms-advanced__hint" style="margin-top: 0.75rem;">
          Standard: prefix + fuzzy (domyślne). N-gram: podciągi o długości {{ svc.options().ngramSize }}
          — łapie fragmenty wewnątrz słów, których prefix nie znajdzie.
        </p>
      }
    </section>

    <!-- MINI DOCUMENTATION -->
    <section class="ms-docs" aria-label="Fragmenty dokumentacji API">
      <h2 class="ms-section-title">Szybka ściąga</h2>
      <p class="ms-section-desc">
        Kluczowe wzorce API, które możesz skopiować i od razu użyć.
      </p>

      <div class="ms-snippets">
        @for (snippet of codeSnippets; track snippet.id) {
          <div class="ms-snippet">
            <div class="ms-snippet__header">
              <h3 class="ms-snippet__title">{{ snippet.title }}</h3>
              <div class="ms-snippet__actions">
                <a
                  class="ms-snippet__doc-link"
                  [href]="snippet.docUrl"
                  target="_blank"
                  rel="noopener noreferrer"
                  data-tooltip="Otwiera stronę dokumentacji związaną z tym przykładem kodu w nowej karcie."
                >
                  Dokumentacja
                </a>
                <button
                  class="ms-snippet__copy"
                  (click)="copySnippet(snippet.code, snippet.id)"
                  [attr.aria-label]="'Kopiuj fragment ' + snippet.title"
                  data-tooltip="Kopiuje ten fragment kodu do schowka, żebyś mógł go wkleić w swoim projekcie."
                >
                  @if (copiedSnippet() === snippet.id) {
                    <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                    <span>Skopiowano!</span>
                  } @else {
                    <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                    <span>Kopiuj</span>
                  }
                </button>
              </div>
            </div>
            <pre class="ms-snippet__code"><code>{{ snippet.code }}</code></pre>
          </div>
        }
      </div>
    </section>

    <!-- COMPARISON TABLE -->
    <section class="ms-comparison" aria-label="Porównanie bibliotek">
      <h2 class="ms-section-title">Jak wypada na tle innych?</h2>
      <div class="ms-table-wrapper">
        <table class="ms-table">
          <thead>
            <tr>
              <th>Funkcja</th>
              <th class="ms-table__highlight">MiniSearch</th>
              <th>Lunr.js</th>
              <th>Fuse.js</th>
              <th>FlexSearch</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Rozmiar (gzip)</td>
              <td class="ms-table__highlight">~7 kB</td>
              <td>~8 kB</td>
              <td>~5 kB</td>
              <td>~6 kB</td>
            </tr>
            <tr>
              <td>Wyszukiwanie rozmyte</td>
              <td class="ms-table__highlight">Tak</td>
              <td>Tak</td>
              <td>Tak (rdzeń)</td>
              <td>Tak</td>
            </tr>
            <tr>
              <td>Wyszukiwanie prefiksowe</td>
              <td class="ms-table__highlight">Tak</td>
              <td>Tak</td>
              <td>Nie</td>
              <td>Tak</td>
            </tr>
            <tr>
              <td>Indeks przyrostowy</td>
              <td class="ms-table__highlight">Tak</td>
              <td>Nie (przebudowa)</td>
              <td>N/D</td>
              <td>Tak</td>
            </tr>
            <tr>
              <td>Podpowiedzi</td>
              <td class="ms-table__highlight">Wbudowane</td>
              <td>Nie</td>
              <td>Nie</td>
              <td>Nie</td>
            </tr>
            <tr>
              <td>Ranking TF-IDF</td>
              <td class="ms-table__highlight">Tak</td>
              <td>Tak</td>
              <td>Nie (Bitap)</td>
              <td>Nie</td>
            </tr>
            <tr>
              <td>TypeScript</td>
              <td class="ms-table__highlight">Natywny</td>
              <td>Tak</td>
              <td>Tak</td>
              <td>Częściowy</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- USE CASES -->
    <section class="ms-usecases" aria-label="Zastosowania">
      <h2 class="ms-section-title">Zastosowania</h2>
      <div class="ms-usecase-grid">
        <div class="ms-usecase-card">
          <h3>Wyszukiwanie w dokumentacji</h3>
          <p>Napędza VitePress i Docusaurus. Indeks budowany przy kompilacji, wyszukiwanie natychmiastowe, działa offline.</p>
        </div>
        <div class="ms-usecase-card">
          <h3>Autouzupełnianie</h3>
          <p>Podpowiedzi w polach formularzy w czasie rzeczywistym. Prefix + autoSuggest bez odwołań do serwera.</p>
        </div>
        <div class="ms-usecase-card">
          <h3>Filtrowanie po stronie klienta</h3>
          <p>Zastąp proste porównywanie tekstu w tabelach wyszukiwaniem z rankingiem trafności i tolerancją literówek.</p>
        </div>
        <div class="ms-usecase-card">
          <h3>Offline / PWA</h3>
          <p>Bez sieci. Zaindeksuj dane raz, szukaj lokalnie bez połączenia.</p>
        </div>
        <div class="ms-usecase-card">
          <h3>Szybkie prototypowanie</h3>
          <p>Pomiń konfigurację Elasticsearch. Wrzuć MiniSearch i miej pełnotekstowe wyszukiwanie w każdym prototypie.</p>
        </div>
        <div class="ms-usecase-card">
          <h3>E-commerce</h3>
          <p>Szybkie wyszukiwanie produktów z tolerancją literówek i wzmacnianiem nazw oraz marek.</p>
        </div>
      </div>
    </section>

    <!-- CUSTOM SOLUTIONS -->
    <section class="ms-custom-solutions" aria-label="Nasze customowe rozwiązania">
      <h2 class="ms-section-title">Co dodaliśmy od siebie</h2>
      <p class="ms-section-desc">
        Ta strona nie pokazuje tylko 'gołego" MiniSearch — dodaliśmy własne warstwy UX na wierzchu biblioteki.
      </p>
      <div class="ms-custom-solutions__grid">
        <div class="ms-custom-solutions__card">
          <h3>Podświetlenia mocy dopasowania</h3>
          <p>
            Wpisz <code>angular</code>, aby zobaczyć mocne dopasowanie (<em>exact</em>, zielony akcent),
            a potem <code>anglar</code> — dopasowanie rozmyte (<em>fuzzy</em>, beżowy akcent).
            Oba warianty w jednym widoku wyników.
          </p>
        </div>
        <div class="ms-custom-solutions__card">
          <h3>Klikalne linki</h3>
          <p>
            Każdy wynik ma link 'Otwórz dokument", a każdy smaczek w 'Szybkiej ściądze"
            prowadzi do odpowiedniego fragmentu dokumentacji.
          </p>
        </div>
        <div class="ms-custom-solutions__card ms-custom-solutions__card--sparkline">
          <h3>Sparkline wydajności na żywo</h3>
          <p>
            Wyszukaj kilka razy &mdash; pod wynikami pojawi się animowany mini-wykres
            z historią czasów odpowiedzi. Pulsująca kropka, gradient i statystyki
            <code>min</code>/<code>avg</code>/<code>max</code> aktualizują się z każdym keystroke.
          </p>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <footer class="ms-footer">
      <h2 class="ms-section-title">Zacznij</h2>
      <div class="ms-footer__install">
        <code class="ms-footer__cmd">npm install minisearch</code>
      </div>
      <div class="ms-footer__links">
        <a
          href="https://github.com/lucaong/minisearch"
          target="_blank"
          rel="noopener noreferrer"
          class="ms-btn ms-btn--primary"
        >Repozytorium GitHub</a>
        <a
          href="https://lucaong.github.io/minisearch/"
          target="_blank"
          rel="noopener noreferrer"
          class="ms-btn ms-btn--secondary"
        >Dokumentacja</a>
      </div>
    </footer>

  }

</div>
